/*
  ==============================================================
  test_annotation.config
  ==============================================================

  This file defines a test annotation workflow using bcftools annotate
  for testing purposes. It adds a mock annotation to the INFO tag.
*/

params {
    /*
      ------------------------------------------------------------
      annotation_cmd:

      A shell snippet or process definition containing the
      essential annotation steps on a single VCF input.

      Example below uses "vcf", but
      you can replace it with ANY tool that modifies VCF INFO
      tags. For multi-step pipelines, you can chain commands
      (e.g., SnpEff -> bcftools index) in a multi-line string.

      AVAILABLE VARIABLES:
      - INPUT_BCF: Path to the input BCF file
        (can be used as INPUT_BCF or ${INPUT_BCF})
      - OUTPUT_BCF: Path where the annotated BCF file should be written
        (can be used as OUTPUT_BCF or ${OUTPUT_BCF})
      - AUXILIARY_DIR: Directory where any additional files can be written
        (can be used as AUXILIARY_DIR or ${AUXILIARY_DIR})
      ------------------------------------------------------------
    */

	annotation_cmd = """
        echo '##INFO=<ID=MOCK_ANNO,Number=1,Type=String,Description=Mock_annotation_for_testing_purposes>' > newheader.txt
        ${params.bcftools_cmd} query -f '%CHROM\\t%POS\\ttest\\n' ${INPUT_BCF} > mockanno.txt
        bgzip -c mockanno.txt > mockanno.txt.gz
        touch ${AUXILIARY_DIR}/auxiliary_test.exo
        tabix -s 1 -b 2 -e 2 mockanno.txt.gz
        ${params.bcftools_cmd} annotate \\
            -a mockanno.txt.gz \\
            -h newheader.txt \\
            -c CHROM,POS,INFO/MOCK_ANNO \\
            ${INPUT_BCF} \\
            -Ob -o ${OUTPUT_BCF} -W
"""

    /*
      ------------------------------------------------------------
      must_contain_info_tag:

      INFO tag that should appear in the final
      annotated VCF/BCF. The pipeline can verify these tags 
      at the end to ensure annotation was successful.
      ------------------------------------------------------------
    */
    must_contain_info_tag = 'MOCK_ANNO'

    /*
      ------------------------------------------------------------
      annotation_tool_version:

      Optional version marker or string for your annotation tool.
      You can use it in main.nf or in your vcfstash Python
      driver to verify that the tool's actual version matches
      the one you locked here.

      If you prefer to skip version checks, just leave required_tool_version
      blank or remove it.
      ------------------------------------------------------------
    */
    required_tool_version = '1.21+htslib-1.21'

}

/*
  ------------------------------------------------------------
  optional checks:

  Optional checks to verify that annotations applied to the cache are the
  same as to the input VCF. All key:values pairs here have to match exactly
  to the values set in the .yaml file. Note that these values are fixed
  after stash-annotate and cannot be changed.
  ------------------------------------------------------------
*/
