/*
  ==============================================================
  annotation.config
  ==============================================================

  This file defines the FIXED/LOCKED annotation workflow commands
  and logic for vcfstash. Once you run:

      vcfstash stash-annotate --anno_config annotation.config

  ...the tool will lock this file in your stash, preventing changes
  that might break consistency with the cached data.

  ----------------------------------------------------------------
  WHAT GOES HERE:
   - The main annotation command (or commands) that apply to all
     variants in your VCF (e.g., running VCF, SnpEff, ANNOVAR,
     or any other annotation workflow).
   - Lists of required INFO tags or checks to verify that your
     annotation worked properly.
   - Optional version strings or constraints for your annotation
     tool (VCF, SnpEff, etc.).

  AFTER STASH-ANNOTATE:
   - This config is considered "frozen." If you want to change the
     annotation logic (for example, switching from VCF to SnpEff
     or adding new parameters), create a NEW annotation config
     and re-run "stash-annotate".
*/

params {
    /*
      ------------------------------------------------------------
      annotation_cmd:
      
      A shell snippet or process definition containing the 
      essential annotation steps on a single VCF input. 

      Example below uses "vcf" with a reference FASTA, but
      you can replace it with ANY tool that modifies VCF INFO 
      tags. For multi-step pipelines, you can chain commands 
      (e.g., SnpEff -> bcftools index) in a multi-line string.
      
      AVAILABLE VARIABLES:
      - INPUT_BCF: Path to the input BCF file
        (can be used as INPUT_BCF or ${INPUT_BCF})
      - OUTPUT_BCF: Path where the annotated BCF file should be written
        (can be used as OUTPUT_BCF or ${OUTPUT_BCF})
      - AUXILIARY_DIR: Directory where any additional files can be written
        (can be used as AUXILIARY_DIR or ${AUXILIARY_DIR})
      ------------------------------------------------------------
    */

    annotation_cmd = """
      ${params.bcftools_cmd} view ${INPUT_BCF} |
      ${params.annotation_tool_cmd} \
        --offline \
        --buffer_size ${params.vep_buffer} \
        --fork ${params.vep_forks} \
        --no_stats \
        --cache \
        --dir_cache ${params.vep_cache} \
        --fasta ${params.reference} \
        --format vcf \
        --vcf \
        --force_overwrite \
        -i STDIN \
        -o STDOUT \
        --warning_file ${AUXILIARY_DIR}/vep_warnings.log \
        -a GRCh37 \
        --transcript_version \
        --total_length \
        --flag_pick \
        --exclude_predicted \
        --hgvs \
        --hgvsg \
        --spdi \
        --variant_class \
        --uniprot \
        --gene_version \
        --protein \
        --symbol \
        --canonical \
        --appris \
        --mane \
        --biotype \
        --domains \
        --refseq | ${params.bcftools_cmd} view -o ${OUTPUT_BCF} -Ob -W
    """

    /*
      ------------------------------------------------------------
      must_contain_info_tag:

      INFO tag that should appear in the final
      annotated VCF/BCF. The pipeline can verify the tag
      at the end to ensure annotation was successful.

      For example, VEP sets the "CSQ" tag. SnpEff might set
      "ANN". If your custom script adds "MYTOOL_ANNOT",
      list that here.
      ------------------------------------------------------------
    */
    must_contain_info_tag = 'CSQ'

    /*
      ------------------------------------------------------------
      annotation_tool_version:

      Optional version marker or string for your annotation tool.
      You can use it in main.nf or in your vcfstash Python
      driver to verify that the tool's actual version matches
      the one you locked here.

      If you prefer to skip version checks, just leave required_tool_version
      blank or remove it.
      ------------------------------------------------------------
    */
    required_tool_version = '115.2'

}

/*
  ------------------------------------------------------------
  optional checks:

  Optional checks to verify that annotations applied to the cache are the
  same as to the input VCF. All key:values pairs here have to match exactly
  to the values set in the .yaml file. Note that these values are fixed
  after stash-annotate and cannot be changed.
  ------------------------------------------------------------
*/
optional_checks {
    reference_md5sum = '28a3d9f0162be1d5db2011aa30458129'
}

/*
  ------------------------------------------------------------
  FURTHER CUSTOMIZATION:

  - If you have multiple steps (e.g., ANNOVAR convert2annovar.pl,
    then table_annovar.pl, then bcftools annotate), you can
    chain them in params.annotation_cmd.
  - If you'd like to keep your logic in multiple parameters
    or define small Groovy code blocks, you can do so here.
  - For tools that need to write auxiliary files, use AUXILIARY_DIR
    which points to the current working directory. For example:

    annotation_cmd = """
      ${params.bcftools_cmd} view INPUT_BCF |
      ${params.vep_cmd} \
        -i stdin \
        -o stdout \
        --warning_file AUXILIARY_DIR/warnings.log \
        --stats_file AUXILIARY_DIR/stats.html \
        | ${params.bcftools_cmd} view -o OUTPUT_BCF -Ob
    """
  
  Important: Once stash-annotate is run, treat this file as 
  READ-ONLY. If you make changes, they won't match the locked 
  version in your stash. 
  ------------------------------------------------------------
*/