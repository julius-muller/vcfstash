/*
  ==============================================================
  annotation.config
  ==============================================================
  
  This file defines the FIXED/LOCKED annotation workflow commands 
  and logic for vcfstash. Once you run:

      vcfstash.py stash-annotate --anno_config annotation.config

  ...the tool will lock this file in your stash, preventing changes 
  that might break consistency with the cached data.
  
  ----------------------------------------------------------------
  WHAT GOES HERE:
   - The main annotation command (or commands) that apply to all 
     variants in your VCF (e.g., running VCF, SnpEff, ANNOVAR,
     or any other annotation workflow).
   - Lists of required INFO tags or checks to verify that your 
     annotation worked properly.
   - Optional version strings or constraints for your annotation 
     tool (VCF, SnpEff, etc.).
  
  AFTER STASH-ANNOTATE:
   - This config is considered "frozen." If you want to change the 
     annotation logic (for example, switching from VCF to SnpEff
     or adding new parameters), create a NEW annotation config 
     and re-run "stash-annotate".
*/

params {
    /*
      ------------------------------------------------------------
      annotation_cmd:
      
      A shell snippet or process definition containing the 
      essential annotation steps on a single VCF input. 

      Example below uses "vcf" with a reference FASTA, but
      you can replace it with ANY tool that modifies VCF INFO 
      tags. For multi-step pipelines, you can chain commands 
      (e.g., SnpEff -> bcftools index) in a multi-line string.
      ------------------------------------------------------------
    */

    annotation_cmd = '''
      # Example: Using Ensembl VEP to annotate a single VCF file
      # with reference data. The actual input will be passed as
      # .csi indexed $INPUT_BCF, and the output will be saved
      # as $OUTPUT_BCF and is required to be .csi indexed either.

      ${params.bcftools} view -o "$INPUT_BCF" -Ou |
      ${params.annotation_tool_cmd} --cache \
        --dir_cache ${params.vep_cache} \
        --fasta ${params.ref_fasta} \
        --format vcf \
        --vcf \
        --force_overwrite \
        -i stdin \
        -o stdout \
        -a GRCh37 \
        --transcript_version \
        --total_length \
        --flag_pick \
        --exclude_predicted \
        --hgvs \
        --hgvsg \
        --spdi \
        --variant_class \
        --uniprot \
        --gene_version \
        --protein \
        --symbol \
        --canonical \
        --appris \
        --mane \
        --biotype \
        --domains \
        --refseq \
        | ${params.bcftools} view -o "$OUTPUT_BCF" -Ob --write-index
    '''

    /*
      ------------------------------------------------------------
      must_contain_info_tags:
      
      A list of INFO tags that should appear in the final 
      annotated VCF/BCF. The pipeline can verify these tags 
      at the end to ensure annotation was successful.
      
      For example, VCF sets the "CSQ" tag. SnpEff might set
      "ANN". If your custom script adds "MYTOOL_ANNOT", 
      list that here.
      ------------------------------------------------------------
    */
    must_contain_info_tags = [ 'CSQ' ]

    /*
      ------------------------------------------------------------
      annotation_tool_version:
      
      Optional version marker or string for your annotation tool.
      You can use it in main.nf or in your vcfstash Python 
      driver to verify that the tool's actual version matches 
      the one you locked here.
      
      If you prefer to skip version checks, just leave required_tool_version
      blank or remove it.
      ------------------------------------------------------------
    */
    required_tool_version = '108.0'
}

/*
  ------------------------------------------------------------
  FURTHER CUSTOMIZATION:
  
  - If you have multiple steps (e.g., ANNOVAR convert2annovar.pl, 
    then table_annovar.pl, then bcftools annotate), you can 
    chain them in params.annotation_cmd. 
  - If you'd like to keep your logic in multiple parameters 
    or define small Groovy code blocks, you can do so here.
  
  Important: Once stash-annotate is run, treat this file as 
  READ-ONLY. If you make changes, they won't match the locked 
  version in your stash. 
  ------------------------------------------------------------
*/
